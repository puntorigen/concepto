'use strict';(function(u,g){"object"===typeof exports&&"undefined"!==typeof module?module.exports=g():"function"===typeof define&&define.amd?define(g):(u="undefined"!==typeof globalThis?globalThis:u||self,u.concepto=g())})(this,function(){function u(a,b,c,d,e,f,p){try{var h=a[f](p),n=h.value}catch(m){c(m);return}h.done?b(n):Promise.resolve(n).then(d,e)}function g(a){return function(){var b=this,c=arguments;return new Promise(function(d,e){function f(a){u(h,d,e,f,p,"next",a)}function p(a){u(h,d,e,
f,p,"throw",a)}var h=a.apply(b,c);f(void 0)})}}function w(a,b){var c=Object.keys(a);if(Object.getOwnPropertySymbols){var d=Object.getOwnPropertySymbols(a);b&&(d=d.filter(function(b){return Object.getOwnPropertyDescriptor(a,b).enumerable}));c.push.apply(c,d)}return c}function h(a){for(var b=1;b<arguments.length;b++){var c=null!=arguments[b]?arguments[b]:{};b%2?w(Object(c),!0).forEach(function(b){var d=c[b];b in a?Object.defineProperty(a,b,{value:d,enumerable:!0,configurable:!0,writable:!0}):a[b]=d}):
Object.getOwnPropertyDescriptors?Object.defineProperties(a,Object.getOwnPropertyDescriptors(c)):w(Object(c)).forEach(function(b){Object.defineProperty(a,b,Object.getOwnPropertyDescriptor(c,b))})}return a}function y(a,b){var c=a;if("string"===typeof c){c={};a=a.split(",");for(var d in a)c[a[d]]=b}else for(var e in c)c[e]=b;return c}function r(a,b){var c=!0,d;for(d of b.split(","))if(!0!==a[d]){c=!1;break}return c}function B(a,b){var c=!0;if(b.toString()!==a.toString())if("number"===typeof b)a==b?c=
!0:a!=b&&(c=!1);else if("string"===typeof b)if(-1==b.indexOf(",")&&"<"==b.charAt(0))a>=parseInt(b.replace("<",""))&&(c=!1);else if(-1==b.indexOf(",")&&">"==b.charAt(0))a<=parseInt(b.replace(">",""))&&(c=!1);else if(-1==b.indexOf(",")&&b!=a.toString())c=!1;else{var d=b.split(",");if(-1==b.indexOf("<")&&-1==b.indexOf(">")&&d.includes(a))c=!0;else if(-1!=b.indexOf("<")||-1!=b.indexOf(">"))for(var e of d)if(">"==e.charAt(0)){if(a<=parseInt(e.replace(">",""))){c=!1;break}}else if("<"==e.charAt(0)&&a>=
parseInt(e.replace("<",""))){c=!1;break}}else c=!1;return c}function z(a,b){return b.split(".").reduce((a,b)=>a[b],a)}function v(){return new Promise(a=>{setImmediate(()=>a())})}class x{constructor(a){var b=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{};if(2!=arguments.length||"object"===typeof arguments[0])throw Error("fatal error! missing file parameter for parser!");var c=require("open_console");this.x_config=h(h({},{class:"concepto",console:!0,debug:!1,cache:!0,dsl_git:!0,prefix:""}),
b);this.x_console=new c({silent:!this.x_config.console});this.x_console.setPrefix({prefix:this.x_config.class,color:"yellow"});this.x_flags={init_ok:!1,dsl:a,watchdog:{start:new Date,end:new Date}};this.x_commands={};this.x_time_stats={times:{},tables:{}};this.x_state={};this.x_memory_cache={findCommand:{},findValidCommand:{},isExactParentID:{},hasBrotherBefore:{},hasBrotherNext:{}};this.x_match=require("minimatch")}init(){var a=this;return g(function*(){if(a.x_flags.init_ok)a.x_console.out({message:"you may only call method init() once!"});
else{var b=require("dsl_parser"),c=require("path"),d=require("fs").promises;a.x_console.title({title:"DSL Interpreter ".concat(a.x_config.class,"\ninit:compiling file:\n").concat(a.x_flags.dsl),color:"cyan",config:{align:"left"}});a.dsl_parser=new b({file:a.x_flags.dsl,config:{cancelled:!1,debug:a.x_config.debug}});try{yield a.dsl_parser.process()}catch(f){a.x_console.out({message:"error: file ".concat(a.x_flags.dsl," does't exist!"),data:f});return}var e=c.dirname(c.resolve(a.x_flags.dsl));a.x_console.outT({message:"time passed since start .. ".concat(a.secsPassed_()),
color:"cyan"});a.x_config.dsl_git&&(a.x_console.outT({message:"creating git compatible DSL",color:"green"}),b=yield a.dsl_parser.createGitVersion(),"boolean"===typeof a.x_config.dsl_git?(a.debug("dsl_git dir",e),c=c.join(e,"vue_git.dsl"),yield d.writeFile(c,b,"utf-8"),a.debug("dsl_git file saved as: ".concat(c))):"function"===typeof a.x_config.dsl_git&&(a.debug("calling dsl_git custom method ".concat(a.x_config.dsl_git.name)),yield a.x_config.dsl_git(b)),a.x_console.outT({message:"ready github compatible DSL",
color:"green"}));a.x_flags.init_ok=!0;try{yield a.onInit()}catch(f){a.x_console.out({message:"onInit() ".concat(f),color:"red"})}}})()}reply_template(){var a=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};return h(h({},{init:"",open:"",close:"",hasChildren:!0,type:"simple",valid:!0,_meta:{_set:{},cache:!0}}),a)}onInit(){return g(function*(){console.log("hello from concepto.js")})()}onAfterProcess(a){return g(function*(){return a})()}onDefineTitle(a){var b=this;return g(function*(){var c=
a.text;Object.keys(a.attributes).map(function(b){if("title"==b||"titulo"==b)return c=a.attributes[b],!1}.bind(b));return c})()}onDefineFilename(a){return g(function*(){return a.text})()}onDefineNodeName(a){return g(function*(){return a.text.replace(" ","_")})()}onCompleteCodeTemplate(a){return g(function*(){return a})()}onPrepare(){return g(function*(){})()}onErrors(a){return g(function*(){})()}onCreateFiles(a){return g(function*(){})()}onEnd(){return g(function*(){})()}addCommands(a){var b=this;
return g(function*(){if(!b.x_flags.init_ok)throw Error("error! the first called method must be init()!");if(a&&"function"===typeof a){var c=yield a(b);if("object"===typeof c)b.x_commands=h(h({},b.x_commands),c);else throw Error("error! addCommands() argument doesn't reply with an Object");}else a&&"object"===typeof a&&(b.x_commands=h(h({},b.x_commands),a))})()}findCommand(){var a=arguments,b=this;return g(function*(){var {node:c=b.throwIfMissing("node"),justone:d=!0,show_debug:e=!0}=0<a.length&&void 0!==
a[0]?a[0]:{};if(!b.x_flags.init_ok)throw Error("error! the first called method must be init()!");var f=h(h({},b.reply_template()),{id:"not_found",hint:"failover command"}),p=[];if("undefined"===typeof c.icons)return e&&b.debug("error: findCommand was given a blank node!"),f;if(c.id in b.x_memory_cache.findCommand)return e&&b.debug("using memory_cache for findCommand for node ID ".concat(c.id)),b.x_memory_cache.findCommand[c.id];e&&b.debug("findCommand for node ID ".concat(c.id));var g=y("x_icons,x_not_icons,x_not_empty,x_not_text_contains,x_empty,x_text_exact,x_text_contains,x_text_pattern,x_level,x_or_hasparent,x_all_hasparent,x_or_isparent",
"");h({},g);g=h({},g);var n=y("x_icons,x_not_icons,x_not_empty,x_not_text_contains,x_empty,x_text_exact,x_text_contains,x_text_pattern,x_level,x_or_hasparent,x_all_hasparent,x_or_isparent",!0),m;for(m in b.x_commands){var l=h({},n),k=h(h({},g),b.x_commands[m]);delete k.func;if(""!=k.x_icons){b.debug_time({id:"".concat(m," x_icons")});for(var u of k.x_icons.split(",")){l.x_icons=c.icons.includes(u)?!0:!1;if(!l.x_icons)break;yield v()}b.debug_timeEnd({id:"".concat(m," x_icons")})}""!=k.x_not_icons&&
r(l,"x_icons,x_not_icons,x_not_empty,x_not_text_contains,x_empty,x_text_exact,x_text_contains,x_text_pattern,x_level,x_or_hasparent,x_all_hasparent,x_or_isparent")&&(b.debug_time({id:"".concat(m," x_not_icons")}),0<c.icons.length&&""!=k.x_not_icons&&["*"].includes(k.x_not_icons)?l.x_not_icons=!1:""!=k.x_not_icons&&(l.x_not_icons=0<b.array_intersect(k.x_not_icons.split(","),c.icons).length?!1:!0),b.debug_timeEnd({id:"".concat(m," x_not_icons")}));if(""!=k.x_not_empty&&r(l,"x_icons,x_not_icons,x_not_empty,x_not_text_contains,x_empty,x_text_exact,x_text_contains,x_text_pattern,x_level,x_or_hasparent,x_all_hasparent,x_or_isparent")){b.debug_time({id:"".concat(m,
" x_not_empty")});var q=k.x_not_empty.replace(/\+/g,"/").replace(/,/g,"+").replace(/\//g,",").split(","),t;for(t of q){if(-1!=t.indexOf(".")){if(q=z(c,t),"string"===typeof q&&""==q||"boolean"===typeof q&&0==q){l.x_not_empty=!1;break}}else-1!=t.indexOf("[")?function(){var a=t.split("[")[0],d=b.dsl_parser.findVariables({text:t,symbol:"[",symbol_closing:"]"}).split("+"),e=[];if("attributes"!=a&&c[a])for(var f of c[a])Object.keys(f).filter(function(a){e.push(a)});else"attributes"==a&&Object.keys(c.attributes).filter(function(a){e.push(a)});
b.array_intersect(e,d).length!=d.length&&(l.x_not_empty=!1)}():t in c&&"string"===typeof c[t]&&""==c[t]?l.x_not_empty=!1:t in c&&"boolean"===typeof c[t]&&0==c[t]?l.x_not_empty=!1:"undefined"===typeof c[t]&&(l.x_not_empty=!1);yield v()}b.debug_timeEnd({id:"".concat(m," x_not_empty")})}if(""!=k.x_not_text_contains&&r(l,"x_icons,x_not_icons,x_not_empty,x_not_text_contains,x_empty,x_text_exact,x_text_contains,x_text_pattern,x_level,x_or_hasparent,x_all_hasparent,x_or_isparent")){b.debug_time({id:"".concat(m,
" x_not_text_contains")});for(var w of k.x_not_text_contains.split(",")){if(-1!=c.text.indexOf(w)){l.x_not_text_contains=!1;break}yield v()}b.debug_timeEnd({id:"".concat(m," x_not_text_contains")})}if(""!=k.x_empty&&r(l,"x_icons,x_not_icons,x_not_empty,x_not_text_contains,x_empty,x_text_exact,x_text_contains,x_text_pattern,x_level,x_or_hasparent,x_all_hasparent,x_or_isparent")){b.debug_time({id:"".concat(m," x_empty")});for(var x of k.x_empty.split(",")){q=z(c,x);if("string"===typeof q&&""!=q){l.x_empty=
!1;break}else if("object"===typeof q&&0<q.length){l.x_empty=!1;break}else if("undefined"===typeof q){l.x_empty=!1;break}yield v()}b.debug_timeEnd({id:"".concat(m," x_empty")})}r(l,"x_icons,x_not_icons,x_not_empty,x_not_text_contains,x_empty,x_text_exact,x_text_contains,x_text_pattern,x_level,x_or_hasparent,x_all_hasparent,x_or_isparent")&&""!=k.x_text_exact&&(b.debug_time({id:"".concat(m," x_text_exact")}),l.x_text_exact=k.x_text_exact==c.text?!0:!1,b.debug_timeEnd({id:"".concat(m," x_text_exact")}));
if(r(l,"x_icons,x_not_icons,x_not_empty,x_not_text_contains,x_empty,x_text_exact,x_text_contains,x_text_pattern,x_level,x_or_hasparent,x_all_hasparent,x_or_isparent")&&""!=k.x_text_contains){b.debug_time({id:"".concat(m," x_text_contains")});if(-1!=k.x_text_contains.indexOf("|")){q=!1;for(var C of k.x_text_contains.split("|"))if(-1!=c.text.indexOf(C)){q=!0;break}l.x_text_contains=q}else if(-1!=k.x_text_contains.indexOf(","))for(var A of k.x_text_contains.split(",")){if(-1==c.text.indexOf(A)||""==
A&&-1==c.text.indexOf(",")){l.x_text_contains=!1;break}}else-1==c.text.toLowerCase().indexOf(k.x_text_contains.toLowerCase())&&(l.x_text_contains=!1);b.debug_timeEnd({id:"".concat(m," x_text_contains")})}""!=k.x_level&&r(l,"x_icons,x_not_icons,x_not_empty,x_not_text_contains,x_empty,x_text_exact,x_text_contains,x_text_pattern,x_level,x_or_hasparent,x_all_hasparent,x_or_isparent")&&(b.debug_time({id:"".concat(m," x_level")}),l.x_level=B(c.level,k.x_level),b.debug_timeEnd({id:"".concat(m," x_level")}));
""!=k.x_or_hasparent&&r(l,"x_icons,x_not_icons,x_not_empty,x_not_text_contains,x_empty,x_text_exact,x_text_contains,x_text_pattern,x_level,x_or_hasparent,x_all_hasparent,x_or_isparent")&&(b.debug_time({id:"".concat(m," x_or_hasparent")}),l.x_or_hasparent=yield b.hasParentID(c.id,k.x_or_hasparent),b.debug_timeEnd({id:"".concat(m," x_or_hasparent")}));""!=k.x_all_hasparent&&r(l,"x_icons,x_not_icons,x_not_empty,x_not_text_contains,x_empty,x_text_exact,x_text_contains,x_text_pattern,x_level,x_or_hasparent,x_all_hasparent,x_or_isparent")&&
(b.debug_time({id:"".concat(m," x_all_hasparent")}),l.x_all_hasparent=yield b.hasParentID(c.id,k.x_all_hasparent,!0),b.debug_timeEnd({id:"".concat(m," x_all_hasparent")}));if(""!=k.x_or_isparent&&r(l,"x_icons,x_not_icons,x_not_empty,x_not_text_contains,x_empty,x_text_exact,x_text_contains,x_text_pattern,x_level,x_or_hasparent,x_all_hasparent,x_or_isparent")){b.debug_time({id:"".concat(m," x_or_isparent")});q=!1;for(var D of k.x_or_isparent.split(",")){q=yield b.isExactParentID(c.id,D);if(1==q)break;
yield v()}l.x_or_isparent=q;b.debug_timeEnd({id:"".concat(m," x_or_isparent")})}"string"===typeof k.x_text_pattern&&""!=k.x_text_pattern&&r(l,"x_icons,x_not_icons,x_not_empty,x_not_text_contains,x_empty,x_text_exact,x_text_contains,x_text_pattern,x_level,x_or_hasparent,x_all_hasparent,x_or_isparent")&&(b.debug_time({id:"".concat(m," x_text_pattern")}),l.x_text_pattern=b.x_match(c.text,k.x_text_pattern),b.debug_timeEnd({id:"".concat(m," x_text_pattern")}));if(1==Array.isArray(k.x_text_pattern)&&0<
k.x_text_pattern.length&&r(l,"x_icons,x_not_icons,x_not_empty,x_not_text_contains,x_empty,x_text_exact,x_text_contains,x_text_pattern,x_level,x_or_hasparent,x_all_hasparent,x_or_isparent")){b.debug_time({id:"".concat(m," x_text_pattern[]")});q=!1;for(var E of k.x_text_pattern)if(q=b.x_match(c.text,E),1==q)break;l.x_text_pattern=q;b.debug_timeEnd({id:"".concat(m," x_text_pattern[]")})}if(r(l,"x_icons,x_not_icons,x_not_empty,x_not_text_contains,x_empty,x_text_exact,x_text_contains,x_text_pattern,x_level,x_or_hasparent,x_all_hasparent,x_or_isparent"))if(f=
Object.entries(k).reduce((a,b)=>a+(""!=b[1]),0),f=h(h(h({},{x_priority:-1}),b.x_commands[m]),{x_id:m,priority:f}),d)break;else p.push(f);yield v()}e&&b.debug_time({id:"sorting by priority"});p=p.sort(function(a,b){return-1!=a.x_priority&&-1!=b.x_priority?b.x_priority-a.x_priority:b.priority-a.priority});e&&b.debug_timeEnd({id:"sorting by priority"});d||(f=p);return b.x_memory_cache.findCommand[c.id]=f})()}findValidCommand(){var a=arguments,b=this;return g(function*(){var {node:c=b.throwIfMissing("node"),
object:d=!1,x_command_shared_state:e={},show_debug:f=!0}=0<a.length&&void 0!==a[0]?a[0]:{};if(!b.x_flags.init_ok)throw Error("error! the first called method must be init()!");if(c.id in b.x_memory_cache.findValidCommand)return b.x_memory_cache.findValidCommand[c.id];f&&b.debug({message:"findValidCommand called for node ".concat(c.id,", level:").concat(c.level,", text:").concat(c.text),color:"yellow"});var p={},g=yield b.findCommand({node:c,justone:!1,show_debug:f});if(0==g.length)b.debug({message:"findValidCommand: no command found.",
color:"red"});else if(1==g.length){p=h({},g[0]);try{var n=yield b.x_commands[p.x_id].func(c,e);p.exec=n;p._f4e=g[0].x_id;f&&b.debug({message:"findValidCommand: 1/1 applying command ".concat(g[0].x_id," ... VALID MATCH FOUND! (nodeid:").concat(c.id,")"),color:"green"})}catch(k){f&&b.debug({message:"findValidCommand: 1/1 applying command ".concat(g[0].x_id," ... ERROR! (nodeid:").concat(c.id,")"),color:"red"}),p.error=!0,p.valid=!1,p.catch=k}}else{f&&b.debug({message:"findValidCommand: ".concat(g.length,
" commands found: (nodeid:").concat(c.id,")"),color:"green"});for(var m in g){n=g[m];try{var l=yield b.x_commands[n.x_id].func(c,e);if(l.valid){f&&b.debug({message:"findValidCommand: ".concat(parseInt(m)+1,"/").concat(g.length," testing command ").concat(n.x_id," ... VALID MATCH FOUND! (nodeid:").concat(c.id,")"),color:"green"});f&&b.debug({message:"---------------------",time:!1});d?p=l:(p=n,p.exec=l,p._f4e=n.x_id);break}}catch(k){f&&b.debug({message:"findValidCommand: error executing command ".concat(n,
" (nodeid:").concat(c.id,")"),data:k,color:"red"}),p.error=!0,p.valid=!1,p.catch=k}}}0==Object.keys(p).length&&(p=!1);return b.x_memory_cache.findValidCommand[c.id]=p})()}process(){var a=this;return g(function*(){if(!a.x_flags.init_ok)throw Error("error! the first called method must be init()!");a.debug_time({id:"process/writer"});var b={nodes:[]};a.x_console.outT({prefix:"process,yellow",message:"processing nodes ..",color:"cyan"});var c=yield a.dsl_parser.getNodes({level:2,nodes_raw:!0});a.debug("calling onPrepare");
a.debug_time({id:"onPrepare"});yield a.onPrepare();a.debug_timeEnd({id:"onPrepare"});for(var d of c)c=yield a.process_main(d,{}),b.nodes.push(c),yield v();a.debug_timeEnd({id:"process/writer"});var e=!1;b.nodes.map(function(a){if(1==a.error)return e=!0,!1});e?a.x_console.title({title:"Interpreter ".concat(a.x_config.class.toUpperCase()," ENDED with ERRORS.\nPlease check your console history.\nCompilation took: ").concat(a.secsPassed_()),color:"red"}):(yield a.onCreateFiles(b.nodes),a.x_console.title({title:"Interpreter ".concat(a.x_config.class.toUpperCase(),
" ENDED. Full Compilation took: ").concat(a.secsPassed_()),color:"green"}),a.debug_table("Amount of Time Per Command"));yield a.onEnd();return b})()}sub_process(a,b,c){var d=this;return g(function*(){var e=h({},a);if(1==e.hasChildren&&1==e.valid){var f=yield b.getNodes(),g=h({},c),r;for(r of f){f=yield d.dsl_parser.getNode({id:r.id,nodes_raw:!0,recurse:!1});var n=yield d.findValidCommand({node:f,object:!1,x_command_shared_state:g});b.state&&(g=h({},n.state));if(n&&n.exec&&1==n.exec.valid)n.exec.state&&
(g=h(h({},g),n.exec.state)),e.init+=n.exec.init,e.code+=n.exec.open,e.x_ids||(e.x_ids=[]),e.x_ids.push(n.x_id),e=yield d.sub_process(e,r,g),e.code+=n.exec.close;else if(1==n.error){d.x_console.outT({message:"error: Executing func x_command:".concat(n.x_id," for node: id:").concat(f.id,", level ").concat(f.level,", text: ").concat(f.text,"."),data:{id:f.id,level:f.level,text:f.text,data:n.catch,x_command_state:g}});yield d.onErrors(["Error executing func for x_command:".concat(n.x_id," for node id ").concat(f.id,
", text: ").concat(f.text," ")]);e.valid=!1;e.hasChildren=!1;e.error=!0;break}yield v()}}return e})()}process_main(a,b){var c=this;return g(function*(){var d={state:b,id:a.id,name:yield c.onDefineNodeName(a),file:yield c.onDefineFilename(a),init:"",title:yield c.onDefineTitle(a),attributes:a.attributes,code:"",open:"",close:"",x_ids:[],subnodes:a.nodes_raw.length};c.x_console.outT({prefix:"process,yellow",message:"processing node ".concat(a.text," .."),color:"yellow"});var e=h({},b),f=yield c.findValidCommand({node:a,
object:!1,x_command_shared_state:e});f&&f.exec&&1==f.exec.valid?(f.exec.state&&(e=h(h({},e),f.exec.state)),d=h(h({},d),f.exec),d.error=!1,d.init+=d.init,d.code+=d.open,d.x_ids||(d.x_ids=[]),d.x_ids.push(f.x_id),"function"===typeof a.getNodes&&(d=yield c.sub_process(d,a,e)),d.code+=d.close,d.x_ids=d.x_ids.join(",")):(1==f.error?(c.x_console.outT({message:"error: Executing func x_command:".concat(f.x_id," for node: id:").concat(a.id,", level ").concat(a.level,", text: ").concat(a.text,"."),data:{id:a.id,
level:a.level,text:a.text,catch:f.catch,x_command_state:f.state}}),yield c.onErrors(["Error executing func for x_command:".concat(f.x_id," for node id ").concat(a.id,", text: ").concat(a.text," ")])):(c.x_console.outT({message:"error: FATAL, no method found for node processing.",data:{id:a.id,level:a.level,text:a.text}}),yield c.onErrors(["No method found for given node id ".concat(a.id,", text: ").concat(a.text," ")])),d.valid=!1,d.hasChildren=!1,d.error=!0);d=yield c.onAfterProcess(d);return d=
yield c.onCompleteCodeTemplate(d)})()}secsPassed_(){var a=(new Date).getTime()-this.x_flags.watchdog.start.getTime();return require("humanize-duration")(a,{maxDecimalPoints:0})}throwIfMissing(a){throw Error("Missing "+a+" parameter!");}array_intersect(a,b){return a.filter(a=>b.includes(a))}array_substract(a,b){return a.filter(a=>!b.includes(a))}array_difference(a,b){return a.filter(a=>!b.includes(a)).concat(b.filter(b=>!a.includes(b)))}array_union(a,b){return[...a,...b]}debug(a,b){var c=1==arguments.length&&
"object"===typeof arguments[0]?arguments[0]:{message:a,data:b};this.x_config.debug&&c.time?this.x_console.outT(h(h({},{prefix:"debug,dim",color:"dim"}),c)):this.x_config.debug&&this.x_console.out(h(h({},{prefix:"debug,dim",color:"dim"}),c))}_appFolders(a){var b=arguments,c=this;return g(function*(){var d=1<b.length&&void 0!==b[1]?b[1]:c.x_state.central_config.apptitle,e=2<b.length?b[2]:void 0,f=require("fs").promises;c.debug("_appFolders");var g=require("path"),h=g.dirname(g.resolve(c.x_flags.dsl))+
g.sep;e&&(h=e);e={base:h,src:h+(d?d:c.x_state.central_config.apptitle)+g.sep};e.app=g.normalize(e.src);e.compile_folder=d;for(var n in a){e[n]=g.join(e.app,a[n]);try{yield f.mkdir(e[n],{recursive:!0})}catch(m){}}return e})()}debug_time(){if(0<arguments.length){var a=h({},arguments[0]);"undefined"!==typeof a.id&&-1!=a.id.indexOf("def_")?(a=a.id.split(" ")[0],"undefined"===typeof this.x_time_stats.times[a]&&-1!=a.indexOf("def_")?(this.x_time_stats.times[a]=new Date,this.x_time_stats.tables[a]={command:a,
calls:0,average_call:0,total_ms:0}):1==this.x_config.debug&&this.x_console.time(h({},arguments[0]))):1==this.x_config.debug&&this.x_console.time(h({},arguments[0]))}}debug_timeEnd(){if(0<arguments.length){var a=h({},arguments[0]),b="";"undefined"!==typeof a.id&&(b=a.id.split(" ")[0]);"undefined"!==typeof a.id&&-1!=b.indexOf("def_")&&b in this.x_time_stats.times?"undefined"!==typeof this.x_time_stats.tables[b]&&(a=(new Date).getTime()-this.x_time_stats.times[b].getTime(),this.x_time_stats.tables[b].calls+=
1,this.x_time_stats.tables[b].total_ms=a,this.x_time_stats.tables[b].average_call=Math.round(this.x_time_stats.tables[b].total_ms/this.x_time_stats.tables[b].calls)):1==this.x_config.debug&&this.x_console.timeEnd(h(h({},{color:"dim",prefix:"debug,dim"}),arguments[0]))}}debug_table(a){var b=[];Object.keys(this.x_time_stats.tables).map(function(a){b.push(this.x_time_stats.tables[a])}.bind(this));this.x_console.table({title:a?a:"Times per Command",data:b,color:"cyan"})}hasBrotherID(){var a=arguments,
b=this;return g(function*(){var c=0<a.length&&void 0!==a[0]?a[0]:b.throwIfMissing("id"),d=1<a.length&&void 0!==a[1]?a[1]:b.throwIfMissing("x_id");if(c+d in b.x_memory_cache.hasBrotherID)return b.x_memory_cache.hasBrotherID[c+d];var e=yield b.dsl_parser.getBrotherNodesIDs({id:c,before:!0,after:!0}).split(","),f=[],g;for(g of e)if(e=yield b.dsl_parser.getNode({id:g,recurse:!1}),e=yield findValidCommand({node:e,show_debug:!1,object:!0}),f.push(e.x_id),1==f.includes(d))return!0;return b.x_memory_cache.hasBrotherID[c+
d]=!1})()}hasBrotherBefore(){var a=arguments,b=this;return g(function*(){var c=0<a.length&&void 0!==a[0]?a[0]:b.throwIfMissing("id");if(!(c in b.x_memory_cache.hasBrotherBefore)){var d=yield b.dsl_parser.getBrotherNodesIDs({id:c,before:!0,after:!1}).split(",");b.x_memory_cache.hasBrotherBefore[c]=d.includes(c)}return b.x_memory_cache.hasBrotherBefore[c]})()}hasBrotherNext(){var a=arguments,b=this;return g(function*(){var c=0<a.length&&void 0!==a[0]?a[0]:b.throwIfMissing("id");if(!(c in b.x_memory_cache.hasBrotherNext)){var d=
yield b.dsl_parser.getBrotherNodesIDs({id:c,before:!1,after:!0}).split(",");b.x_memory_cache.hasBrotherNext[c]=d.includes(c)}return b.x_memory_cache.hasBrotherNext[c]})()}isExactParentID(){var a=arguments,b=this;return g(function*(){var c=0<a.length&&void 0!==a[0]?a[0]:b.throwIfMissing("id"),d=1<a.length&&void 0!==a[1]?a[1]:b.throwIfMissing("x_id");if(c+d in b.x_memory_cache.isExactParentID)return b.x_memory_cache.isExactParentID[c+d];var e=yield b.dsl_parser.getParentNode({id:c});return(e=yield b.findValidCommand({node:e,
show_debug:!1,object:!0}))&&e.x_id==d?b.x_memory_cache.isExactParentID[c+d]=!0:b.x_memory_cache.isExactParentID[c+d]=!1})()}hasParentID(){var a=arguments,b=this;return g(function*(){var c=0<a.length&&void 0!==a[0]?a[0]:b.throwIfMissing("id"),d=1<a.length&&void 0!==a[1]?a[1]:b.throwIfMissing("x_id"),e=2<a.length&&void 0!==a[2]?a[2]:!1;d=d.split(",");var f=yield b.dsl_parser.getParentNodesIDs({id:c,array:!0});c=[];for(var g of f)if(f=yield b.dsl_parser.getNode({id:g,recurse:!1}),f=yield b.findValidCommand({node:f,
show_debug:!1,object:!0}),0==e&&d.includes(f.x_id)||0!=e&&1==e&&(c.push(f.x_id),b.array_intersect(c,d).length==d.length))return!0;return b.array_intersect(c,d).length==d.length?!0:!1})()}getParentIDs(){var a=arguments,b=this;return g(function*(){var c=0<a.length&&void 0!==a[0]?a[0]:b.throwIfMissing("id"),d=1<a.length&&void 0!==a[1]?a[1]:!1,e=yield b.dsl_parser.getParentNodesIDs({id:c,array:!0});c=[];for(var f of e)e=yield b.dsl_parser.getNode({parent_id:f,recurse:!1}),(e=yield b.findValidCommand({node:e,
show_debug:!1}))&&d?c.push({id:f,x_id:e.x_id}):c.push(e.x_id);return d&&1==d?c:c.join(",")})()}getParentIDs2Array(){var a=arguments,b=this;return g(function*(){var c=0<a.length&&void 0!==a[0]?a[0]:b.throwIfMissing("id");return yield b.getParentIDs(c,!0)})()}getParentIDs2ArrayWXID(){var a=arguments,b=this;return g(function*(){var c=0<a.length&&void 0!==a[0]?a[0]:b.throwIfMissing("id");return(yield b.getParentIDs(c,!0)).map(a=>{a.id})})()}tagParams(){var a=0<arguments.length&&void 0!==arguments[0]?
arguments[0]:"",b=2<arguments.length&&void 0!==arguments[2]?arguments[2]:!1,c=this.struct2params(1<arguments.length&&void 0!==arguments[1]?arguments[1]:{});a=""!=c?"<".concat(a," ").concat(c):"<".concat(a);1==b&&(a+="/");return a+">"}struct2params(){var a=0<arguments.length&&void 0!==arguments[0]?arguments[0]:this.throwIfMissing("id"),b=[],c,d;for([c,d]of Object.entries(a))"object"!==typeof d&&"function"!==typeof d&&"undefined"!==typeof d&&b.push("".concat(c,"='").concat(d,"'"));return b.join(" ")}cleanIDs4node(){var a=
0<arguments.length&&void 0!==arguments[0]?arguments[0]:this.throwIfMissing("node");delete a.id;return a}}return x})
